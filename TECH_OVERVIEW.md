# Техническая архитектура ватсап бота

## Основные компоненты

**Твилио** - прием и отправка сообщений в ватсап  
**Сервер в Azure** - хостинг программы на питоне  
**Умный роутер** - анализ входящих сообщений и определение стратегии ответа  
**Система поиска** - поиск релевантной информации в базе недвижимости  
**Векторная база** - база данных для семантического поиска  
**ИИ Azure** - генерация ответов через нейросеть  

## Алгоритм работы

1. Клиент отправляет сообщение через ватсап
2. Твилио передает сообщение на сервер в Azure
3. Умный роутер анализирует содержимое сообщения
4. Если обнаружена внешняя ссылка - извлекаются данные из адреса
5. Формируется умный запрос для поиска в базе недвижимости
6. Система поиска находит подходящие объекты в векторной базе
7. Нейросеть генерирует персонализированный ответ
8. Детектор лидов определяет тип интереса клиента
9. Ответ отправляется обратно через твилио

## Ключевые модули

**Smart Router** - определяет стратегию обработки (direct/consultant/hybrid)  
**URL Parser** - извлекает информацию из ссылок Inmuebles24  
**Query Generator** - формирует оптимальные запросы для RAG  
**Lead Detector** - автоматическое определение потенциальных покупателей  
**Response Formatter** - адаптация ответов под разные сценарии  

## Технический стек

**Backend:** Python, Flask, Gunicorn  
**AI/ML:** Azure OpenAI, LangChain, FAISS  
**Storage:** Redis (сессии), Vector DB (недвижимость)  
**Infrastructure:** Azure App Service, GitHub Actions  
**Integration:** Twilio WhatsApp Business API  

## Масштабируемость

Система спроектирована для обработки множественных запросов одновременно.  
Векторная база оптимизирована для быстрого поиска среди тысяч объектов.  
Кэширование сессий в Redis обеспечивает контекст разговора.  
Azure App Service автоматически масштабируется под нагрузку. 